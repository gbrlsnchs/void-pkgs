pipeline:
  list:
    image: "debian:sid"
    commands:
      - "apt-get update"
      - "apt-get install --yes git"
      - "./common/woodpecker/list.sh"
  list_rebuild:
    when:
      path: [".woodpecker/*", "common/woodpecker/**/*", "scripts/*"]
    image: "debian:sid"
    commands:
      - "./common/woodpecker/list_rebuild.sh"
  clean_pre:
    image: "debian:sid"
    commands:
      - "apt-get update"
      - "apt-get install --yes git"
      - "git fetch && git worktree add pre && rm --recursive --force pre/*"
      - "./common/woodpecker/commit.sh 'Clean up old binaries' pre"
    secrets: ["access_token"]
  commit:
    image: "debian:sid"
    commands:
      - "apt-get update"
      - "apt-get install --yes git"
      - "./common/woodpecker/commit.sh 'Prepare packages to build' ci"
    secrets: ["access_token"]

branches: ["trunk"]
